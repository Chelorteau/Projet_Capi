<!DOCTYPE html>
<html>
<head>
    <title>Vote pour la fonctionnalité</title>
    <style>
        .highlight { background-color: yellow; }
    </style>
    <script>
        function submitVote(vote) {
            fetch('/submit_vote', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'vote=' + vote
            })
            .then(response => response.json())
            .then(data => {
                if (data.all_ready) startCountdown();
            })
            .catch(error => console.error('Erreur lors de l\'envoi du vote:', error));
        }

        function checkVotes() {
            fetch('/check_votes/{{ game_key }}')
                .then(response => response.json())
                .then(data => updateVotes(data.votes, data.all_ready))
                .catch(error => console.error('Erreur lors de la vérification des votes:', error));
        }

        function updateVotes(votes, allReady) {
            const votesList = document.getElementById('votesList');
            votesList.innerHTML = '';
            for (const [player, vote] of Object.entries(votes)) {
                const li = document.createElement('li');
                li.textContent = `${player}: ${vote}`;
                votesList.appendChild(li);
            }

            if (allReady) startCountdown();
        }

        let countdown = 3;
        let timer;

        function startCountdown() {
            if (timer) return;
            timer = setInterval(() => {
                document.getElementById('countdown').textContent = countdown;
                countdown--;
                if (countdown < 0) {
                    clearInterval(timer);
                    window.location.href = '/game';
                }
            }, 1000);
        }

        setInterval(checkVotes, 1000);
    </script>
</head>
<body>
    <h1>Fonctionnalité : {{ feature['name'] }}</h1>
    <h2>Description : {{ feature['description'] }}</h2>
    
    <div id="votesList"></div>
    
    <div>
        <button onclick="submitVote(0)" value="0">0</button>
        <button onclick="submitVote(1)" value="1">1</button>
        <button onclick="submitVote(2)" value="2">2</button>
        <button onclick="submitVote(3)" value="3">3</button>
        <button onclick="submitVote(5)" value="5">5</button>
        <button onclick="submitVote(8)" value="8">8</button>
        <button onclick="submitVote(13)" value="13">13</button>
        <button onclick="submitVote(20)" value="20">20</button>
        <button onclick="submitVote(40)" value="40">40</button>
        <button onclick="submitVote(100)" value="100">100</button>
        <button onclick="submitVote('cafe')" value="cafe">Café</button>
        <button onclick="submitVote('?')" value="?">?</button>
    </div>

    <h2 id="countdown"></h2>
</body>
</html>
